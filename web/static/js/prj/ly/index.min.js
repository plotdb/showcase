function in$(t,e){for(var n=-1,r=e.length>>>0;++n<r;)if(t===e[n])return!0;return!1}var d1,ref$,unique,pairsToObj,sum,flatten,keys,d41,color,partyColor,constuiencyMap,loadHash,topo;d1=new Date,unique=(ref$=require("prelude-ls")).unique,pairsToObj=ref$.pairsToObj,sum=ref$.sum,flatten=ref$.flatten,keys=ref$.keys,d41=0,color=d3.scale.category20(),partyColor=d3.scale.ordinal().domain(["KMT","DPP","PFP","TSU","NSU","NON"]).range(["#0D2393","#009900","#FF6211","#994500","#CD1659","#999999"]),constuiencyMap={"彰化縣":"CHA","嘉義市":"CYI","嘉義縣":"CYQ","新竹縣":"HSQ","新竹市":"HSZ","花蓮縣":"HUA","宜蘭縣":"ILA","基隆市":"KEE","高雄市":"KHH","高雄縣":"KHQ","苗栗縣":"MIA","南投縣":"NAN","澎湖縣":"PEN","屏東縣":"PIF","桃園縣":"TAO","台南市":"TNN","台南縣":"TNQ","台北市":"TPE","新北市":"TPQ","台東縣":"TTT","台中市":"TXG","台中縣":"TXQ","雲林縣":"YUN"},loadHash=!1,topo=[],$(document).ready(function(){var t;return t={},d3.json("/assets/prj/ly/mly-8-with-sex.json",function(e){var n,r,a,o;for(n=new Date,r=0,a=e.length;r<a;++r)o=e[r],t[o.name]=o;return d3.json("/assets/prj/ly/ttsinterpellation.compact.json",function(e){var r,a,o,u,l,i,c,s,f,p,d,h,y,g,m,v,A;return r=new Date,a=e.entries,a=a.map(function(t){return t.asked_by||(t.asked_by=[]),t}).filter(function(e){var n;return function(){var r,a,o,u=[];for(r=0,o=(a=e.asked_by).length;r<o;++r)n=a[r],u.push(t[n]);return u}().filter(function(t){return t}).length>0}),o=new Date,u=crossfilter(a),l=u.dimension(function(t){return t.asked_by}),i=u.dimension(function(e){return e.asked_by.map(function(e){return t[e].party})}),c=u.dimension(function(t){return t.asked_by.map(function(t){return t.substring(0,1)})}),s=u.dimension(function(e){return e.asked_by.map(function(e){return t[e].sex})}),f=u.dimension(function(e){return e.asked_by.map(function(e){return t[e].constuiency[0]})}),p=new Date,d={},h=function(t,e,n,r){return null==r&&(r=null),d[e]=n=n===d[e]?null:n,n?t.filter(r||n):t.filterAll(),A(m.category.filter.top(1/0))},y={true:1,false:.2},g=function(t,e){return!d[t]||d[t]===e},m={},["topic","category","keywords"].map(function(t){var e,n,r,o,l,i,c;for((m[t]||(m[t]={})).hash={},m[t].filter=u.dimension(function(e){return e[t]}),m[t].list=flatten(function(){var n,r,o,u=[];for(n=0,o=(r=a).length;n<o;++n)e=r[n],u.push(e[t]);return u}()),n=0,o=(r=m[t].list).length;n<o;++n)e=r[n],(l=m[t].hash)[e]>=0||(l[e]=0),m[t].hash[e]++;return m[t].list=[(r=function(){var e,n=[];for(i in e=m[t].hash)c=e[i],n.push({text:i,rawSize:c});return n}().sort(function(t,e){return e.rawSize-t.rawSize}))[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15],r[16],r[17],r[18],r[19],r[20],r[21],r[22],r[23],r[24],r[25],r[26],r[27],r[28],r[29],r[30],r[31],r[32],r[33],r[34],r[35],r[36],r[37],r[38],r[39],r[40],r[41],r[42],r[43],r[44],r[45],r[46],r[47],r[48],r[49],r[50],r[51],r[52],r[53],r[54],r[55],r[56],r[57],r[58],r[59],r[60],r[61],r[62],r[63],r[64],r[65],r[66],r[67],r[68],r[69],r[70],r[71],r[72],r[73],r[74],r[75],r[76],r[77],r[78],r[79],r[80],r[81],r[82],r[83],r[84],r[85],r[86],r[87],r[88],r[89],r[90],r[91],r[92],r[93],r[94],r[95],r[96],r[97],r[98],r[99],r[100],r[101],r[102],r[103],r[104],r[105],r[106],r[107],r[108],r[109],r[110],r[111],r[112],r[113],r[114],r[115],r[116],r[117],r[118],r[119],r[120],r[121],r[122],r[123],r[124],r[125],r[126],r[127],r[128],r[129],r[130],r[131],r[132],r[133],r[134],r[135],r[136],r[137],r[138],r[139],r[140],r[141],r[142],r[143],r[144],r[145],r[146],r[147],r[148],r[149]].filter(function(t){return t})}),v=new Date,A=function(e){var a,u,c,d,A,w,k,x,b,D,N,T,C,P,j,S,H,M,U,O,E,F,Y,$,R,_,B,K,Q,z,I,Z;for(a=new Date,m.category.filter.top(1/0).length,u=new Date,(c=d={}).group=s.group().top(1/0),c.count=sum([0,1].map(function(t){return d.group[t].value})),c.ratio=("男"===d.group[0].key[0]?[0,1]:[1,0]).map(function(t){return d.group[t].value/d.count}),c.ratio=d.ratio.map(function(t){var e;return[t,(e=t>.2?t:.2)<.8?e:.8]}),d3.select("#male.block").datum(d.ratio[0]),d3.select("#female.block").datum(d.ratio[1]),d3.selectAll("#gender .block").each(function(t){var e;return(e=d3.select(this)).select("img").style("width",200*t[1]+"px"),e.select(".count").text(~~(100*t[0])+"%"),e}).on("click",function(t,e){return h(s,"sex",["女","男"][e])}).style("opacity",function(t,e){return y[g("sex",["女","男"][e])]}),A=new Date,k=0,b=(x=(w={group:i.group().top(1/0),count:0,hash:{}}).group).length;k<b;++k)for(N=0,C=(T=(D=x[k]).key).length;N<C;++N)(P=T[N])||(P="NON"),(j=w.hash)[P]>=0||(j[P]=0),w.hash[P]+=D.value,w.count+=D.value;for(w.ratio=["KMT","DPP","PFP","TSU","NSU","NON"].map(function(t){return{name:t,value:w.hash[t]/w.count||0}}),100,S=d3.layout.pie().sort(null).value(function(t){return t.value}),H=d3.svg.arc().outerRadius(100/2.3).innerRadius(100/4.5),w.root=d3.select("#party svg g"),(M=w.root.selectAll("path.arc").data(S(w.ratio))).exit().remove(),M.enter().append("path").attr("class","arc"),d3.selectAll("#party svg path.arc").attr("d",H).attr("fill",function(t){return g("party",t.data.name)?partyColor(t.data.name):"#999"}).on("click",function(t){return h(i,"party",t.data.name)}).style("opacity",function(t){return y[g("party",t.data.name)]}),(U=d3.select("#party .flags").selectAll("div.flag").data(w.ratio.sort(function(t,e){return e.value-t.value}))).exit().remove(),U.enter().append("div").attr("class","flag").each(function(){var t;return(t=d3.select(this)).append("i"),t.append("div").attr("class","title"),t}),d3.select("#party .flags").selectAll("div.flag").each(function(){var t;return(t=d3.select(this)).select("i").attr("class",function(t){return"g0v-icon large "+t.name}),t.select(".title").text(function(t){return~~(100*t.value)+"%"}),t}).on("click",function(t){return h(i,"party",t.name)}).style("opacity",function(t){return y[g("party",t.name)]}),O=new Date,k=0,b=(x=(E={group:f.group().top(1/0),count:0,hash:{}}).group).length;k<b;++k)for(N=0,C=(T=(D=x[k]).key).length;N<C;++N)P=T[N],(j=E.hash)[P]>=0||(j[P]=0),E.hash[P]+=D.value,E.count+=D.value;for(topo.features.map(function(t){return t.name=constuiencyMap[t.properties.COUNTYNAME],t.value=Math.sqrt((E.hash[t.name]||0)/E.count)}),E.max=d3.max(function(){var t,e,n,r=[];for(t=0,n=(e=topo.features).length;t<n;++t)F=e[t],r.push(F.value);return r}()),d3.select("#county svg").selectAll("path.county").style("fill",function(t){var e;return"rgba("+(e=~~(255*t.value/E.max))+","+~~(e/2)+","+~~(e/3)+", "+(.5+.5*e/255)+")"}).on("click",function(t){return h(f,"constuiency",t.name)}).style("opacity",function(t){return y[g("constuiency",t.name)]}),Y=new Date,$={group:l.group().top(1/0),hash:{},count:0},sum(function(){var t,e,n,r=[];for(t=0,n=(e=$.group).length;t<n;++t)F=e[t],r.push(1+F.value||1);return r}())/$.group.length,k=0,b=(x=$.group).length;k<b;++k)for(N=0,C=(T=(D=x[k]).key).length;N<C;++N)P=T[N],(j=$.hash)[P]>=0||(j[P]=0),$.hash[P]+=D.value,$.count+=D.value;if($.data=function(){var t,e=[];for(R in t=$.hash)_=t[R],e.push({name:R,value:(1+_||1)/$.count,count:_});return e}().filter(function(t){return t.count}),(B=d3.select("#asked-by").selectAll("div.avatar").data($.data)).exit().remove(),B.enter().append("div").attr("class","avatar").each(function(){var t;return(t=d3.select(this)).append("div").attr("class","img").append("img"),t.append("div").attr("class","title"),t.append("div").attr("class","times"),t}),d3.select("#asked-by").selectAll("div.avatar").each(function(e){var n;return(n=d3.select(this)).select("img").attr("src",function(){return CryptoJS.MD5("MLY/"+e.name).toString(),"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABBJREFUeNpi+P//PwNAgAEACPwC/tuiTRYAAAAASUVORK5CYII="}).style("width",function(){var t,n;return((t=(n=400*e.value)>15?n:15)<50?t:50)+"px"}).style("height",function(){var t,n;return((t=(n=400*e.value)>15?n:15)<50?t:50)+"px"}).style("border",function(){return"3px solid "+partyColor(t[e.name].party)}),n.select("div.title").text(function(){return e.name}),n.select("div.times").text(function(){return e.count}),n}).on("click",function(t){return h(l,"asked-by",t.name)}).style("opacity",function(t){return y[g("asked-by",t.name)]}),K=new Date,Q={},["topic","category","keywords"].map(function(t){var e,n,r,a,o,u,l,i,c,s,f,p;for(new Date,(Q[t]||(Q[t]={})).group=m[t].filter.group().top(1/0),Q[t].hash={},e=0,r=(n=Q[t].group).length;e<r;++e)for(o=0,l=(u=(a=n[e]).key).length;o<l;++o)i=u[o],(c=Q[t].hash)[i]>=0||(c[i]=0),Q[t].hash[i]+=a.value;for(n=[0,99999],Q[t].max=n[0],Q[t].min=n[1],Q[t].data=[(n=function(){var e,n=[];for(s in e=Q[t].hash)i=e[s],n.push({text:s,value:i});return n}().sort())[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15],n[16],n[17],n[18],n[19],n[20],n[21],n[22],n[23],n[24],n[25],n[26],n[27],n[28],n[29],n[30],n[31],n[32],n[33],n[34],n[35],n[36],n[37],n[38],n[39],n[40],n[41],n[42],n[43],n[44],n[45],n[46],n[47],n[48],n[49],n[50],n[51],n[52],n[53],n[54],n[55],n[56],n[57],n[58],n[59],n[60],n[61],n[62],n[63],n[64],n[65],n[66],n[67],n[68],n[69],n[70],n[71],n[72],n[73],n[74],n[75],n[76],n[77],n[78],n[79],n[80],n[81],n[82],n[83],n[84],n[85],n[86],n[87],n[88],n[89],n[90],n[91],n[92],n[93],n[94],n[95],n[96],n[97],n[98],n[99]].sort(function(){return~~(2*Math.random()-1)}),Q[t].list=function(){var e,n,r,o=[];for(e=0,r=(n=Q[t].data).length;e<r;++e)a=n[e],o.push(a.value);return o}(),(u=Q[t]).max=d3.max(Q[t].list),u.min=d3.min(Q[t].list),f=Q[t].max-Q[t].min,e=0,r=(u=Q[t].data).length;e<r;++e)(a=u[e]).size=12+(a.value-Q[t].min)/f*14;return new Date,(p=d3.select("#"+t+" .desc").selectAll(".tag").data(Q[t].data)).exit().remove(),p.enter().append("div").attr("class","tag"),d3.selectAll("#"+t+" .desc .tag").text(function(t){return t.text}).style("font-size",function(t){return t.size+"px"}).attr("class",function(e,n){return n===Q[t].data.length-1?"tag end":"tag"}).on("click",function(e){return h(m[t].filter,t,e.text,function(t){return in$(e.text,t||[])})}).style("opacity",function(e){return y[g(t,e.text)]}),new Date}),z=new Date,[d1,n,r,o,p,v,d41,a,u,A,O,Y,K,z].map(function(t){return t.getTime()}),!loadHash&&(loadHash=!0,I=/\#([^#]+)$/.exec(window.location.href),Z=I?I[1]:""))return h(l,"asked-by",Z)},d3.json("/assets/prj/ly/twCounty2010.topo.json",function(t){var e,n;return d41=new Date,topo=topojson.feature(t,t.objects["twCounty2010.geo"]),e=d3.geo.mercator().center([120.979531,23.978567]).scale(9e4),n=d3.geo.path().projection(e),d3.select("#county svg").selectAll("path.county").data(topo.features).enter().append("path").attr("class","county").attr("d",n).style("fill",function(t){return color(t.properties.COUNTYNAME)}).style("stroke","#fff").style("stroke-width","3px"),A(m.category.filter.top(1/0))}),window.reset=function(){return f.filterAll(),s.filterAll(),c.filterAll(),i.filterAll(),m.category.filter.filterAll(),m.keywords.filter.filterAll(),m.topic.filter.filterAll(),l.filterAll(),["topic","category","keywords"].map(function(t){return m[t].filter.filterAll()}),d={},A(m.category.filter.top(1/0))}})})});